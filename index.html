<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pincoin Safe</title>
<style>
body {
  background-color: #000;
  color: #00bfff;
  font-family: 'Courier New', monospace;
  margin:0; padding:0;
}
.container {
  max-width: 450px;
  margin: 20px auto;
  padding: 30px;
  background: rgba(0,0,0,0.85);
  border: 2px solid #00bfff;
  border-radius: 12px;
  text-align:center;
  box-shadow:0 0 20px #00bfff;
}
h1 {letter-spacing:2px; margin-bottom:15px; color:#00bfff;}
input, button {
  font-size: 16px;
  padding:8px;
  margin-bottom:10px;
  border-radius:6px;
  border:2px solid #00bfff;
  background:#000;
  color:#00bfff;
}
input:focus {outline:none; box-shadow:0 0 8px #00bfff;}
button:hover {background:#00bfff; color:#000; cursor:pointer;}
.prize {margin-top:20px; font-weight:bold; font-size:20px; color:#00bfff; padding:10px; border:2px solid #00bfff; border-radius:8px;}
.chat, .bot-chat, .user-chat {width:100%; max-height:150px; overflow-y:auto; background: rgba(0,0,0,0.85); border:2px solid #00bfff; border-radius:8px; padding:10px; font-size:14px; color:#00bfff; margin-bottom:10px;}
.chat-input {width:60%; padding:5px; border-radius:4px; border:1px solid #00bfff; background:#000; color:#00bfff;}
.chat-btn {padding:5px 10px; margin-left:5px; border-radius:4px; border:1px solid #00bfff; background:#000; color:#00bfff; cursor:pointer;}
#langModal, #privacyModal {position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:flex; justify-content:center; align-items:center; z-index:9999;}
.modal-content {max-width:450px; max-height:80%; overflow-y:auto; background:#000; padding:20px; border:2px solid #00bfff; border-radius:12px;}
.modal-content h2 {margin-top:0;}
button.accept:disabled {opacity:0.5; cursor:not-allowed;}
.badge {margin:15px 0; padding:10px; border:2px solid #00bfff; border-radius:8px; font-weight:bold;}
</style>
</head>
<body>

<!-- Selección de idioma -->
<div class="modal" id="langModal">
  <div class="modal-content">
    <h2>Choose your language / Elige idioma</h2>
    <button onclick="setLanguage('en')">English</button>
    <button onclick="setLanguage('es')">Español</button>
  </div>
</div>

<!-- Política -->
<div class="modal" id="privacyModal" style="display:none;">
  <div class="modal-content" id="privacyContent">
    <h2>Privacy Policy / Política de Privacidad</h2>
    <div id="privacyText" style="max-height:400px; overflow:auto; text-align:left;">
      <p>Pincoin es una plataforma de entretenimiento vinculada a la memecoin Pincoin. La participación es voluntaria y solo con fines de juego.</p>
      <p>Conectar la wallet Phantom sirve únicamente para verificar posesión de Pincoin. No se almacenan datos sensibles ni privados.</p>
      <p>El bote total es de 10,000,000 PIN. El premio máximo es el 25%, decidido por la comunidad o admin, siempre público por redes.</p>
      <p>La probabilidad de éxito es baja y aumenta con el valor de Pincoin, hasta un 20% cuando el token llegue a $1. Actualizaciones semanales.</p>
      <p>Al aceptar, el usuario declara entender y dar consentimiento a todo lo anterior.</p>
      <p>Esto es un juego, no constituye inversión ni asesoramiento financiero.</p>
    </div>
    <button class="accept" id="acceptBtn" disabled onclick="acceptPrivacy()">I Accept / Acepto</button>
  </div>
</div>

<div class="container" id="mainContent" style="display:none;">
  <h1>PINCOIN</h1>
  <div class="badge" id="priceBadge">Current price: $0.00 | Win chance: very low</div>
  <input type="text" id="pin" placeholder="Enter PIN / Introduce PIN">
  <button onclick="tryPin()">Try / Probar</button>
  <div id="result"></div>
  <div class="prize">BOTE: 10,000,000 PIN</div>
  <div class="chat" id="globalChat"></div>
  <input class="chat-input" id="chatInput" placeholder="Mensaje / Message">
  <button class="chat-btn" onclick="sendMessage()">Send / Enviar</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
// Configuración Supabase
const SUPABASE_URL = "https://ijsxpqbqasegolfpdtkl.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqc3hwcWJxYXNlZ29sZnBkdGtsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxOTE2ODUsImV4cCI6MjA3NTc2NzY4NX0.gTTyAs_1g8qtF3Tu1dok3lg631bAZKWVMiLm3WT1xH4";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Idioma
let language = 'en';
function setLanguage(lang){
  language = lang;
  const langModal = document.getElementById('langModal');
  const privacyModal = document.getElementById('privacyModal');
  if(langModal) langModal.style.display = 'none';
  if(privacyModal) privacyModal.style.display = 'flex';
}

// Política con scroll + timer
let scrolled = false, timerOK = false;
const acceptBtn = document.getElementById('acceptBtn');
document.getElementById('privacyText').addEventListener('scroll', ()=>{
  const el = document.getElementById('privacyText');
  if(el.scrollTop + el.clientHeight >= el.scrollHeight){ scrolled=true; checkEnable();}
});
setTimeout(()=>{ timerOK=true; checkEnable(); },5000);
function checkEnable(){ if(scrolled && timerOK) acceptBtn.disabled=false; }
function acceptPrivacy(){
  document.getElementById('privacyModal').style.display='none';
  document.getElementById('mainContent').style.display='block';
  loadPrice();
  loadChat();
}

// Probabilidad demo
let currentPrice = 0.01; // ejemplo
let Pmax = 0.2;
let targetPrice = 1.0;
function loadPrice(){
  let P = Math.min(Pmax, Pmax * (currentPrice/targetPrice));
  document.getElementById('priceBadge').innerText = `Current price: $${currentPrice.toFixed(3)} | Win chance: very low`;
}

// Intentos
let attempts = 0;
function tryPin(){
  attempts++;
  const result = Math.random() < Math.min(Pmax, Pmax*(currentPrice/targetPrice)) ? "WIN!" : "Try again...";
  document.getElementById('result').innerText = `Attempt ${attempts}: ${result}`;
}

// Chat global
async function loadChat(){
  const { data } = await supabase.from('global_chat').select('*').order('created_at',{ascending:true}).limit(20);
  const chatDiv = document.getElementById('globalChat');
  chatDiv.innerHTML = '';
  data.forEach(m=>{
    chatDiv.innerHTML += `Pincoin:${m.username}: ${m.message}<br>`;
  });
}
async function sendMessage(){
  const input = document.getElementById('chatInput');
  const msg = input.value.trim();
  if(!msg) return;
  const username = prompt("Choose your username / Elige nombre:","User");
  await supabase.from('global_chat').insert([{username,msg}]);
  input.value='';
  loadChat();
}
</script>
</body>
</html>