<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pincoin Safe</title>
<style>
body { background-color:#000; color:#00f; font-family:'Courier New', monospace; margin:0; padding:0;}
.container { max-width:400px; margin:20px auto; padding:30px; background:rgba(0,0,0,0.85); border:4px solid #00f; border-radius:12px; text-align:center; box-shadow:0 0 30px #00f;}
h1 {letter-spacing:2px; margin-bottom:15px;}
input, button { font-size:18px; padding:10px; margin-bottom:10px; border-radius:6px; border:2px solid #00f; background:#000; color:#00f;}
input:focus {outline:none; box-shadow:0 0 10px #00f;}
button:hover {background:#00f; color:#000; box-shadow:0 0 15px #00f; cursor:pointer;}
.prize {margin-top:20px; font-weight:bold; font-size:24px; color:#00f; padding:15px; border:3px solid #00f; border-radius:12px;}
.modal {position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:flex; justify-content:center; align-items:center; z-index:9999;}
.modal-content {max-width:400px; max-height:80%; overflow-y:auto; background:#000; padding:20px; border:3px solid #00f; border-radius:12px;}
.modal h2 {margin-top:0;}
.chat-window {width:100%; height:200px; overflow-y:auto; background: rgba(0,0,0,0.85); border:2px solid #00f; border-radius:12px; padding:10px; font-size:14px; color:#00f; margin-bottom:10px;}
.chat-input {width:70%; padding:5px; border-radius:4px; border:1px solid #00f; background:#000; color:#00f;}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<!-- Modal idioma -->
<div class="modal" id="languageModal">
  <div class="modal-content">
    <h2>Choose Language / Elige idioma</h2>
    <button onclick="setLanguage('es')">Español</button>
    <button onclick="setLanguage('en')">English</button>
  </div>
</div>

<!-- Modal política privacidad -->
<div class="modal" id="privacyModal" style="display:none;">
  <div class="modal-content">
    <h2 id="privacyTitle"></h2>
    <div id="privacyText" style="max-height:300px; overflow-y:auto; text-align:left;"></div>
    <button onclick="acceptPrivacy()" id="privacyAcceptBtn"></button>
  </div>
</div>

<div class="container" id="mainContent" style="display:none;">
  <h1>PINCOIN</h1>
  <div>Intentos: <span id="clickCounter">0</span></div>
  <div class="prize">BOTE: 10,000,000 $PIN</div>

  <input type="text" id="walletInput" placeholder="Introduce tu wallet">
  <button onclick="checkWallet()" id="verifyBtn"></button>

  <button class="chat-btn" onclick="toggleChat()" id="chatBtn"></button>
</div>

<!-- Modal chat -->
<div class="modal" id="chatModal" style="display:none;">
  <div class="modal-content">
    <h2 id="chatTitle"></h2>
    <div class="chat-window" id="chatWindow"></div>
    <input type="text" id="chatInput" class="chat-input" placeholder="">
    <button onclick="sendMessage()" id="sendBtn"></button>
    <button onclick="toggleChat()" id="closeChatBtn"></button>
  </div>
</div>

<script>
// --- Supabase ---
const supabaseUrl = 'https://ijsxpqbqasegolfpdtkl.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqc3hwcWJxYXNlZ29sZnBkdGtsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxOTE2ODUsImV4cCI6MjA3NTc2NzY4NX0.gTTyAs_1g8qtF3Tu1dok3lg631bAZKWVMiLm3WT1xH4';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

let clickCounter = 0;
let lang = 'es';
const blacklist = ['puta','mierda','idiota','tonto','estupido','gilipollas','coño','joder','hostia','cabrón','imbecil','tarado'];

// --- Textos traducibles ---
const texts = {
  es:{
    privacyTitle:"Política de Privacidad",
    privacyText:`Esta web es un juego de entretenimiento. Se permite el uso de Pincoin únicamente como utilidad. Todo usuario acepta que la web puede cambiar porcentajes, premios y reglas en cualquier momento. El premio se entrega a la wallet del intento ganador y puede tardar 20-30 días aprox. No nos responsabilizamos del mal uso.`,
    acceptBtn:"Acepto",
    chatTitle:"Chat Global",
    chatInput:"Escribe tu mensaje",
    sendBtn:"Enviar",
    closeChatBtn:"Cerrar",
    chatBtn:"Abrir Chat Global",
    verifyBtn:"Verificar titularidad Pincoin"
  },
  en:{
    privacyTitle:"Privacy Policy",
    privacyText:`This website is for entertainment purposes only. Pincoin use is only for utility. Users agree that the website can change percentages, prizes, and rules at any time. The prize will be sent to the wallet of the winning attempt and may take 20-30 days approx. We are not responsible for misuse.`,
    acceptBtn:"I Accept",
    chatTitle:"Global Chat",
    chatInput:"Type your message",
    sendBtn:"Send",
    closeChatBtn:"Close",
    chatBtn:"Open Global Chat",
    verifyBtn:"Verify Pincoin ownership"
  }
};

// --- Idioma ---
function setLanguage(l){
  lang=l;
  document.getElementById('languageModal').style.display='none';
  showPrivacyModal();
}

// --- Modal privacidad ---
function showPrivacyModal(){
  document.getElementById('privacyModal').style.display='flex';
  document.getElementById('privacyTitle').textContent = texts[lang].privacyTitle;
  document.getElementById('privacyText').textContent = texts[lang].privacyText;
  document.getElementById('privacyAcceptBtn').textContent = texts[lang].acceptBtn;
}

function acceptPrivacy(){
  document.getElementById('privacyModal').style.display='none';
  document.getElementById('mainContent').style.display='block';
  document.getElementById('chatBtn').textContent = texts[lang].chatBtn;
  document.getElementById('verifyBtn').textContent = texts[lang].verifyBtn;
  document.getElementById('chatInput').placeholder = texts[lang].chatInput;
  document.getElementById('sendBtn').textContent = texts[lang].sendBtn;
  document.getElementById('closeChatBtn').textContent = texts[lang].closeChatBtn;
}

// --- Verificación manual de titularidad ---
async function verifyWallet(walletAddress){
  const mintAddress = "Jz1Jy2oxiNeyCF5TLPX4RMoAiCVpczpk1rFFzS1pump"; // Dirección real de Pincoin
  const response = await fetch("https://api.mainnet-beta.solana.com", {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        jsonrpc:"2.0",
        id:1,
        method:"getTokenAccountsByOwner",
        params:[walletAddress,{mint:mintAddress},{encoding:"jsonParsed"}]
      })
  });
  const data = await response.json();
  if(data.result.value.length>0){
    alert("¡Eres titular del token PIN! Puedes participar.");
    return true;
  } else {
    alert("No eres titular del token PIN. No puedes participar.");
    return false;
  }
}

function checkWallet(){
  const wallet = document.getElementById("walletInput").value.trim();
  if(wallet) verifyWallet(wallet);
  else alert("Introduce una wallet válida");
}

// --- Chat ---
function toggleChat(){
  const modal = document.getElementById('chatModal');
  modal.style.display = modal.style.display==='none'?'flex':'none';
  if(modal.style.display==='flex') loadMessages();
}

async function loadMessages(){
  const { data, error } = await supabase.from('chat_global').select('*').order('created_at',{ascending:true}).limit(20);
  const chatWindow = document.getElementById('chatWindow');
  chatWindow.innerHTML='';
  data.forEach(msg=>{
    const div=document.createElement('div');
    div.textContent=`Pincoin:${msg.username}: ${msg.message}`;
    chatWindow.appendChild(div);
  });
  chatWindow.scrollTop=chatWindow.scrollHeight;
}

async function sendMessage(){
  const input = document.getElementById('chatInput');
  let message = input.value.trim();
  if(!message) return;
  if(blacklist.some(p=>message.toLowerCase().includes(p))){
    alert('Mensaje no permitido');
    input.value='';
    return;
  }
  const username = prompt('Nickname')||'anonimus';
  await sup