<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pincoin Safe</title>
<style>
body {
  background-color: #001f3f;
  color: #00ffff;
  font-family: 'Courier New', monospace;
  margin:0;
  padding:0;
}
.container {
  max-width: 400px;
  margin: 20px auto;
  padding: 30px;
  background: rgba(0,0,0,0.85);
  border: 4px solid #00ffff;
  border-radius: 12px;
  text-align:center;
  box-shadow:0 0 30px #00ffff;
}
h1 {letter-spacing:2px; margin-bottom:15px;}
input, button {
  font-size: 18px;
  padding:10px;
  margin-bottom:10px;
  border-radius:6px;
  border:2px solid #00ffff;
  background:#001f3f;
  color:#00ffff;
}
input:focus {outline:none; box-shadow:0 0 10px #00ffff;}
button:hover {background:#00ffff; color:#001f3f; box-shadow:0 0 15px #00ffff; cursor:pointer;}
.prize {margin-top:20px; font-weight:bold; font-size:24px; color:#00ffff; padding:15px; border:3px solid #00ffff; border-radius:12px;}
.chat, .bot-chat, .user-chat {width:100%; max-height:150px; overflow-y:auto; background: rgba(0,0,0,0.85); border:2px solid #00ffff; border-radius:12px; padding:10px; font-size:14px; color:#00ffff; margin-bottom:10px;}
.chat-input {width:60%; padding:5px; border-radius:4px; border:1px solid #00ffff; background:#001f3f; color:#00ffff;}
.chat-btn {padding:5px 10px; margin-left:5px; border-radius:4px; border:1px solid #00ffff; background:#001f3f; color:#00ffff; cursor:pointer;}
.modal {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.95);
  display:flex; justify-content:center; align-items:center;
  z-index:9999;
}
.modal-content {max-width:400px; max-height:80%; overflow-y:auto; background:#001f3f; padding:20px; border:3px solid #00ffff; border-radius:12px;}
.modal h2 {margin-top:0;}
button.accept {margin-top:10px;}
#winnerModal {display:none;}
.language-select {margin-bottom:20px;}
#tryCounter {margin-top:10px; font-weight:bold;}
</style>
</head>
<body>

<!-- Modal idioma -->
<div class="modal" id="languageModal">
  <div class="modal-content">
    <h2>Choose Language / Elige idioma</h2>
    <div class="language-select">
      <button onclick="setLanguage('en')">English</button>
      <button onclick="setLanguage('es')">Español</button>
    </div>
  </div>
</div>

<!-- Modal privacidad -->
<div class="modal" id="privacyModal" style="display:none;">
  <div class="modal-content">
    <h2>Privacy Policy & Terms / Política de Privacidad</h2>
    <p>Este es un juego con fines de entretenimiento. No existe un PIN correcto fijo, cada intento se decide por probabilidad. La probabilidad puede ser modificada según la comunidad o administradores. El premio se enviará al wallet del intento ganador manualmente. Puede tardar entre 20-30 días orientativos.</p>
    <p>Al aceptar, usted da su consentimiento pleno y entiende las reglas del juego. No nos hacemos responsables del mal uso del sistema.</p>
    <button class="accept" onclick="acceptPrivacy()">I Accept / Aceptar</button>
  </div>
</div>

<!-- Contenido principal -->
<div class="container" id="mainContent" style="display:none;">
  <h1>PINCOIN SAFE</h1>
  <p>Frase meme: "No se trata de suerte… se trata de tener PINCOIN."</p>
  <input type="text" id="wallet" placeholder="Enter your wallet / Introduce tu wallet"><br>
  <button onclick="verifyWallet()">Verify Wallet / Verificar</button>
  <p><a href="https://solscan.io/token/Jz1Jy2oxiNeyCF5TLPX4RMoAiCVpczpk1rFFzS1pump" target="_blank">View PINCOIN on Solana / Ver PINCOIN en Solana</a></p>
  
  <input type="text" id="pin" placeholder="Enter PIN / Introduce PIN"><br>
  <button onclick="tryPin()">Try / Intentar</button>
  <div id="tryCounter">Attempts / Intentos: 0</div>
  <div id="result"></div>
  
  <div class="prize">PRIZE / PREMIO: 10,000,000 PIN</div>
  
  <div class="chat" id="globalChat"></div>
  <input type="text" id="chatInput" class="chat-input" placeholder="Type message / Escribe mensaje">
  <button class="chat-btn" onclick="sendMessage()">Send / Enviar</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
// ----------------- Supabase -----------------
const supabaseUrl = "https://ijsxpqbqasegolfpdtkl.supabase.co";
const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqc3hwcWJxYXNlZ29sZnBkdGtsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxOTE2ODUsImV4cCI6MjA3NTc2NzY4NX0.gTTyAs_1g8qtF3Tu1dok3lg631bAZKWVMiLm3WT1xH4";
const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);

// ----------------- Idioma -----------------
let language = null;
function setLanguage(lang){
  language = lang;
  document.getElementById('languageModal').style.display='none';
  document.getElementById('privacyModal').style.display='flex';
}

// ----------------- Privacidad -----------------
function acceptPrivacy(){
  document.getElementById('privacyModal').style.display='none';
  document.getElementById('mainContent').style.display='block';
}

// ----------------- Wallet -----------------
let walletVerified = false;
function verifyWallet(){
  const wallet = document.getElementById('wallet').value.trim();
  if(wallet.length>0){
    // Aquí se podría añadir verificación real con Solscan
    walletVerified=true;
    alert('Wallet verified / Wallet verificada');
  } else {
    alert('Enter a valid wallet / Introduce wallet válida');
  }
}

// ----------------- Contador y PIN -----------------
let attempts = 0;
function tryPin(){
  if(!walletVerified){
    alert('Verify your wallet first / Verifica tu wallet primero');
    return;
  }
  attempts++;
  document.getElementById('tryCounter').innerText = language==='es'?`Intentos: ${attempts}`:`Attempts: ${attempts}`;
  const win = Math.random() < 0.00000000001; // probabilidad muy baja
  if(win){
    document.getElementById('result').innerText = language==='es'?'¡Ganaste!':'You won!';
    saveWinner(document.getElementById('wallet').value, document.getElementById('pin').value);
  } else {
    document.getElementById('result').innerText = language==='es'?'Fallaste, intenta de nuevo':'Try again';
  }
}

// ----------------- Supabase - guardar ganador -----------------
async function saveWinner(wallet, pin){
  const { data, error } = await supabase.from('winners').insert([
    { wallet: wallet, intento: pin }
  ]);
}

// ----------------- Chat global -----------------
async function loadChat(){
  const { data } = await supabase.from('global_chat').select().order('created_at',{ascending:true}).limit(20);
  const chatDiv = document.getElementById('globalChat');
  chatDiv.innerHTML='';
  data.forEach(msg=>{
    chatDiv.innerHTML+=`<div>Pincoin: ${msg.username}: ${msg.message}</div>`;
  });
}
async function sendMessage(){
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  if(message.length===0) return;
  await supabase.from('global_chat').insert([{username:'User', message:message}]);
  input.value='';
  loadChat();
}
setInterval(loadChat,5000);
</script>

</body>
</html>