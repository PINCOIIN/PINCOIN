<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pincoin Safe</title>
<style>
body {
  background-color: #000;
  color: #00cfff; /* azul claro */
  font-family: 'Courier New', monospace;
  margin:0;
  padding:0;
}
.container {
  max-width: 400px;
  margin: 20px auto;
  padding: 30px;
  background: rgba(0,0,0,0.85);
  border: 4px solid #00cfff;
  border-radius: 12px;
  text-align:center;
  box-shadow:0 0 30px #00cfff;
}
h1 {letter-spacing:2px; margin-bottom:15px; color:#00cfff;}
input, button {
  font-size: 18px;
  padding:10px;
  margin-bottom:10px;
  border-radius:6px;
  border:2px solid #00cfff;
  background:#000;
  color:#00cfff;
}
input:focus {outline:none; box-shadow:0 0 10px #00cfff;}
button:hover {background:#00cfff; color:#000; box-shadow:0 0 15px #00cfff; cursor:pointer;}
.prize {margin-top:20px; font-weight:bold; font-size:24px; color:#00cfff; padding:15px; border:3px solid #00cfff; border-radius:12px;}
.chat, .bot-chat, .user-chat {width:100%; max-height:150px; overflow-y:auto; background: rgba(0,0,0,0.85); border:2px solid #00cfff; border-radius:12px; padding:10px; font-size:14px; color:#00cfff; margin-bottom:10px;}
.chat-input {width:60%; padding:5px; border-radius:4px; border:1px solid #00cfff; background:#000; color:#00cfff;}
.chat-btn {padding:5px 10px; margin-left:5px; border-radius:4px; border:1px solid #00cfff; background:#000; color:#00cfff; cursor:pointer;}
.modal {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.95);
  display:flex; justify-content:center; align-items:center;
  z-index:9999;
}
.modal-content {max-width:400px; max-height:80%; overflow-y:auto; background:#000; padding:20px; border:3px solid #00cfff; border-radius:12px;}
.modal h2 {margin-top:0;}
button.accept {margin-top:10px;}
#winnerModal {display:none;}
</style>
</head>
<body>

<!-- Modal de idioma -->
<div class="modal" id="languageModal">
  <div class="modal-content">
    <h2>Selecciona idioma / Select language</h2>
    <button onclick="setLanguage('es')">Español</button>
    <button onclick="setLanguage('en')">English</button>
  </div>
</div>

<!-- Modal de privacidad -->
<div class="modal" id="privacyModal" style="display:none;">
  <div class="modal-content">
    <h2>Política de Privacidad y Términos</h2>
    <p>Pincoin es una memecoin con utilidad.</p>
    <p>Para participar debes conectar tu wallet Phantom y tener al menos 1 Pincoin.</p>
    <p>Los intentos son gratuitos e ilimitados mientras tengas 1 Pincoin o más.</p>
    <p>Todo se borra automáticamente; la web puede editarse en cualquier momento.</p>
    <p>El premio máximo es 25% del bote y lo decide la comunidad o el administrador.</p>
    <p>Al aceptar, das permiso a lo mencionado y entiendes perfectamente todo.</p>
    <p>Esto es un juego; no es inversión ni venta de nada.</p>
    <button class="accept" onclick="acceptPrivacy()">Acepto</button>
  </div>
</div>

<!-- Contenido principal -->
<div class="container" id="mainContent" style="display:none;">
  <h1>PINCOIN</h1>
  <p>Bote: 10,000,000 PIN</p>
  <p>Probabilidad: Muy baja (aumenta con la moneda)</p>

  <input type="text" id="pin" placeholder="Introduce PIN">
  <button onclick="tryPin()">Probar</button>
  <button onclick="toggleAnon()">Anónimo: OFF</button>
  <div id="result"></div>
  <div class="prize" id="prize">PREMIO: 10,000,000 PIN</div>

  <!-- Chat global -->
  <div class="chat" id="globalChat"></div>
  <input type="text" id="chatInput" class="chat-input" placeholder="Tu mensaje...">
  <button class="chat-btn" onclick="sendMessage()">Enviar</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
let language = null;
let anon = false;
const SUPABASE_URL = "https://ijsxpqbqasegolfpdtkl.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqc3hwcWJxYXNlZ29sZnBkdGtsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxOTE2ODUsImV4cCI6MjA3NTc2NzY4NX0.gTTyAs_1g8qtF3Tu1dok3lg631bAZKWVMiLm3WT1xH4";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

function setLanguage(lang){
  language = lang;
  document.getElementById("languageModal").style.display = "none";
  document.getElementById("privacyModal").style.display = "flex";
}

function acceptPrivacy(){
  document.getElementById("privacyModal").style.display = "none";
  document.getElementById("mainContent").style.display = "block";
  loadGlobalChat();
}

function toggleAnon(){
  anon = !anon;
  alert("Modo anónimo: " + (anon ? "ON" : "OFF"));
}

async function tryPin(){
  const pin = document.getElementById("pin").value;
  const resultDiv = document.getElementById("result");
  let success = Math.random() < 0.00000000001; // probabilidad muy baja
  if(success){
    resultDiv.innerText = "¡Correcto! Has ganado.";
  } else {
    resultDiv.innerText = "Fallaste, inténtalo de nuevo.";
  }
}

// --- Chat global con Supabase ---
async function loadGlobalChat(){
  let { data, error } = await supabase
    .from('global_chat')
    .select('*')
    .order('created_at', { ascending: false })
    .limit(20);
  
  const chatDiv = document.getElementById("globalChat");
  chatDiv.innerHTML = "";
  data.reverse().forEach(msg => {
    let name = anon ? "Anónimo" : msg.username;
    chatDiv.innerHTML += `<div><strong>${name}:</strong> ${msg.message}</div>`;
  });
}

async function sendMessage(){
  const input = document.getElementById("chatInput");
  const message = input.value.trim();
  if(!message) return;
  let username = prompt("Introduce tu nickname:", "Usuario");
  if(!username) username = "Anonimo";
  await supabase.from('global_chat').insert([{ username, message }]);
  input.value = "";
  loadGlobalChat();
}

// refrescar chat cada 5 segundos
setInterval(()=>{ if(language && document.getElementById("mainContent").style.display=="block") loadGlobalChat(); },5000);

</script>
</body>
</html>